<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logging in... - Where Am I Listening?</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" type="image/x-icon" href="img/favicon.ico">
</head>
<body class="callback-page">
    <div class="container">
        <div class="spinner"></div>
        <p id="status">Completing login...</p>
        <p id="error" class="error" style="display: none;"></p>
        <a id="retry-link" href="index.html" class="retry-link" style="display: none;">Try again</a>
    </div>

    <script type="module" src="js/auth.js"></script>
    <script type="module">
        async function completeLogin() {
            const statusEl = document.getElementById('status');
            const errorEl = document.getElementById('error');
            const retryEl = document.getElementById('retry-link');

            try {
                await window.SpotifyAuth.handleCallback();
                statusEl.textContent = 'Login successful! Redirecting...';
                // Redirect to globe page
                setTimeout(() => {
                    window.location.href = 'globe.html';
                }, 500);
            } catch (error) {
                console.error('Login failed:', error);
                statusEl.style.display = 'none';
                document.querySelector('.spinner').style.display = 'none';
                errorEl.style.display = 'block';
                errorEl.textContent = error.message || 'Login failed. Please try again.';
                retryEl.style.display = 'block';
            }
        }

        // Run on page load
        completeLogin();
    </script>
</body>
</html>
